<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Dashboards project</title>
  <meta name="description" content="A guide to authoring books with R Markdown, including how to generate figures and tables, and insert cross-references, citations, HTML widgets, and Shiny apps in R Markdown. The book can be exported to HTML, PDF, and e-books (e.g. EPUB). The book style is customizable. You can easily write and preview the book in RStudio IDE or other editors, and host the book wherever you want (e.g. bookdown.org).">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Dashboards project" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://folkehelseinstituttet.github.io/dashboards/" />
  <meta property="og:image" content="https://folkehelseinstituttet.github.io/dashboards/images/fhi.svg" />
  <meta property="og:description" content="A guide to authoring books with R Markdown, including how to generate figures and tables, and insert cross-references, citations, HTML widgets, and Shiny apps in R Markdown. The book can be exported to HTML, PDF, and e-books (e.g. EPUB). The book style is customizable. You can easily write and preview the book in RStudio IDE or other editors, and host the book wherever you want (e.g. bookdown.org)." />
  <meta name="github-repo" content="folkehelseinstituttet/dashboards" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Dashboards project" />
  
  <meta name="twitter:description" content="A guide to authoring books with R Markdown, including how to generate figures and tables, and insert cross-references, citations, HTML widgets, and Shiny apps in R Markdown. The book can be exported to HTML, PDF, and e-books (e.g. EPUB). The book style is customizable. You can easily write and preview the book in RStudio IDE or other editors, and host the book wherever you want (e.g. bookdown.org)." />
  <meta name="twitter:image" content="https://folkehelseinstituttet.github.io/dashboards/images/fhi.svg" />

<meta name="author" content="Richard White">


<meta name="date" content="2018-11-01">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="introduction.html">
<link rel="next" href="r-packages.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Dashboards</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#executive-summary"><i class="fa fa-check"></i><b>1.1</b> Executive summary</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-is-an-automated-analysis"><i class="fa fa-check"></i><b>1.2</b> What is an automated analysis?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#why-not-have-one-project-for-each-automated-analysis"><i class="fa fa-check"></i><b>1.3</b> Why not have one project for each automated analysis?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#important-repositories"><i class="fa fa-check"></i><b>1.4</b> Important repositories</a><ul>
<li class="chapter" data-level="1.4.1" data-path="introduction.html"><a href="introduction.html#infrastructure"><i class="fa fa-check"></i><b>1.4.1</b> Infrastructure</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction.html"><a href="introduction.html#automated-analyses-r-packages"><i class="fa fa-check"></i><b>1.4.2</b> Automated analyses R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html"><i class="fa fa-check"></i><b>2</b> Umbrella Infrastructure</a><ul>
<li class="chapter" data-level="2.1" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#physical-hardware-and-subscriptions"><i class="fa fa-check"></i><b>2.1</b> Physical hardware and subscriptions</a><ul>
<li class="chapter" data-level="2.1.1" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#requirements---smhb"><i class="fa fa-check"></i><b>2.1.1</b> Requirements - smhb</a></li>
<li class="chapter" data-level="2.1.2" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#requirements---linux"><i class="fa fa-check"></i><b>2.1.2</b> Requirements - linux</a></li>
<li class="chapter" data-level="2.1.3" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#requirements---dev"><i class="fa fa-check"></i><b>2.1.3</b> Requirements - dev</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#analysis-docker-image"><i class="fa fa-check"></i><b>2.2</b> Analysis Docker image</a><ul>
<li class="chapter" data-level="2.2.1" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#images"><i class="fa fa-check"></i><b>2.2.1</b> Images</a></li>
<li class="chapter" data-level="2.2.2" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#file-structure"><i class="fa fa-check"></i><b>2.2.2</b> File structure</a></li>
<li class="chapter" data-level="2.2.3" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#cron"><i class="fa fa-check"></i><b>2.2.3</b> cron</a></li>
<li class="chapter" data-level="2.2.4" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#autofs"><i class="fa fa-check"></i><b>2.2.4</b> autofs</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#reverse-proxy-docker-image"><i class="fa fa-check"></i><b>2.3</b> Reverse proxy Docker image</a></li>
<li class="chapter" data-level="2.4" data-path="umbrella-infrastructure.html"><a href="umbrella-infrastructure.html#docker-compose"><i class="fa fa-check"></i><b>2.4</b> Docker compose</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-packages.html"><a href="r-packages.html"><i class="fa fa-check"></i><b>3</b> R packages</a><ul>
<li class="chapter" data-level="3.1" data-path="r-packages.html"><a href="r-packages.html#generic"><i class="fa fa-check"></i><b>3.1</b> Generic</a><ul>
<li class="chapter" data-level="3.1.1" data-path="r-packages.html"><a href="r-packages.html#overview"><i class="fa fa-check"></i><b>3.1.1</b> Overview</a></li>
<li class="chapter" data-level="3.1.2" data-path="r-packages.html"><a href="r-packages.html#requirements"><i class="fa fa-check"></i><b>3.1.2</b> Requirements</a></li>
<li class="chapter" data-level="3.1.3" data-path="r-packages.html"><a href="r-packages.html#deployment-via-travis-ci-and-drat"><i class="fa fa-check"></i><b>3.1.3</b> Deployment via travis-ci and drat</a></li>
<li class="chapter" data-level="3.1.4" data-path="r-packages.html"><a href="r-packages.html#integration-with-the-local-file-system"><i class="fa fa-check"></i><b>3.1.4</b> Integration with the local file system</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html"><i class="fa fa-check"></i><b>4</b> Integrating the R package into the physical system</a><ul>
<li class="chapter" data-level="4.1" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#summary"><i class="fa fa-check"></i><b>4.1</b> Summary</a></li>
<li class="chapter" data-level="4.2" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#runprocess.r"><i class="fa fa-check"></i><b>4.2</b> RunProcess.R</a><ul>
<li class="chapter" data-level="4.2.1" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#aim"><i class="fa fa-check"></i><b>4.2.1</b> Aim</a></li>
<li class="chapter" data-level="4.2.2" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#bounded-context"><i class="fa fa-check"></i><b>4.2.2</b> Bounded context</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#run.sh"><i class="fa fa-check"></i><b>4.3</b> 0_run.sh</a><ul>
<li class="chapter" data-level="4.3.1" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#aim-1"><i class="fa fa-check"></i><b>4.3.1</b> Aim</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#runtest.r"><i class="fa fa-check"></i><b>4.4</b> RunTest.R</a><ul>
<li class="chapter" data-level="4.4.1" data-path="integrating-the-r-package-into-the-physical-system.html"><a href="integrating-the-r-package-into-the-physical-system.html#aim-2"><i class="fa fa-check"></i><b>4.4.1</b> Aim</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="contributing.html"><a href="contributing.html"><i class="fa fa-check"></i><b>5</b> Contributing</a><ul>
<li class="chapter" data-level="5.1" data-path="contributing.html"><a href="contributing.html#development-guidelines"><i class="fa fa-check"></i><b>5.1</b> Development guidelines</a></li>
<li class="chapter" data-level="5.2" data-path="contributing.html"><a href="contributing.html#code-style"><i class="fa fa-check"></i><b>5.2</b> Code style</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://www.fhi.no/" target="blank">www.fhi.no</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Dashboards project</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="umbrella-infrastructure" class="section level1">
<h1><span class="header-section-number">2</span> Umbrella Infrastructure</h1>
<div id="physical-hardware-and-subscriptions" class="section level2">
<h2><span class="header-section-number">2.1</span> Physical hardware and subscriptions</h2>
<ul>
<li>At least three computers</li>
</ul>
<ol style="list-style-type: decimal">
<li>Production linux computer <code>smhb</code></li>
<li>Testing linux computer <code>linux</code></li>
<li>Development linux computers (1 per person)</li>
</ol>
<ul>
<li>One Github organization (<a href="http://github.com/folkehelseinstituttet/" class="uri">http://github.com/folkehelseinstituttet/</a>)</li>
<li>One Github team (<a href="https://github.com/orgs/folkehelseinstituttet/teams/dashboards" class="uri">https://github.com/orgs/folkehelseinstituttet/teams/dashboards</a>)</li>
<li>One <a href="https://github.com/eddelbuettel/drat">DRAT</a> repository (<a href="https://folkehelseinstituttet.github.io/drat/" class="uri">https://folkehelseinstituttet.github.io/drat/</a>)</li>
<li>One travis-ci.org account (<a href="http://travis-ci.org/folkehelseinstituttet" class="uri">http://travis-ci.org/folkehelseinstituttet</a>)</li>
<li>One travis-ci.com account (<a href="http://travis-ci.com/folkehelseinstituttet" class="uri">http://travis-ci.com/folkehelseinstituttet</a>)</li>
<li>One Docker hub account (<a href="http://hub.docker.com/u/raw996/" class="uri">http://hub.docker.com/u/raw996/</a>)</li>
</ul>
<div id="requirements---smhb" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Requirements - smhb</h3>
<ul>
<li>Git</li>
<li>Docker Engine - Community (<a href="https://www.docker.com/products/docker-engine" class="uri">https://www.docker.com/products/docker-engine</a>)</li>
</ul>
</div>
<div id="requirements---linux" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Requirements - linux</h3>
<ul>
<li>Git</li>
<li>Docker Engine - Community (<a href="https://www.docker.com/products/docker-engine" class="uri">https://www.docker.com/products/docker-engine</a>)</li>
<li>Jenkins installed via a Docker container (<a href="http://jenkins.io" class="uri">http://jenkins.io</a>)</li>
</ul>
</div>
<div id="requirements---dev" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Requirements - dev</h3>
<ul>
<li>Git</li>
<li>Docker Engine - Community (<a href="https://www.docker.com/products/docker-engine" class="uri">https://www.docker.com/products/docker-engine</a>)</li>
</ul>
</div>
</div>
<div id="analysis-docker-image" class="section level2">
<h2><span class="header-section-number">2.2</span> Analysis Docker image</h2>
<div id="images" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Images</h3>
<p>Our analysis Docker images are based off the <a href="https://rocker-project.org">rocker</a> images. More specifically, the <a href="https://hub.docker.com/r/rocker/verse/">rocker/verse:3.5.0</a> image.</p>
<p>This Docker image is then expanded upon by a separate Dockerfile <a href="https://github.com/raubreywhite/docker/blob/master/dhadley/Dockerfile">raw996/dhadley</a>. This Docker image is automatically rebuilt by <code>Jenkins</code> on <code>linux</code> whenever the repository is updated. The resultant Docker image is pushed to <a href="https://hub.docker.com/r/raw996/dhadley/">raw996/dhadley:3.5.0</a>. This image is a general-purpose analysis image, with no sensitive information in it.</p>
<p>This Docker image is then expanded upon by a separate Dockerfile <a href="https://github.com/raubreywhite/dashboards_control/blob/master/infrastructure/dashboards_r/Dockerfile">raw996/dashboards_r</a>. This Docker image is automatically rebuilt by <code>Jenkins</code> on <code>linux</code> whenever the repository is updated. The resultant Docker image is locally tagged as <code>raw996/dashboards_r:test</code> and then a number of integration tests are performed on it. If the integration tests are passed, then the Docker image is retagged and pushed to <a href="https://hub.docker.com/r/raw996/dashboards_r/">raw996/dashboards_r:production</a>. This image is private as it contains passwords and email addresses.</p>
</div>
<div id="file-structure" class="section level3">
<h3><span class="header-section-number">2.2.2</span> File structure</h3>
<p>Inside <code>raw996/dashboards_r</code> we have the following file structure:</p>
<pre><code>/data_raw/
  |-- normomo/
  |-- noispiah/
  |-- sykdomspuls/
  |-- sykdomspuls_pdf/
  |-- sykdomspuls_log/
/data_clean/
  |-- normomo/
  |-- noispiah/
  |-- sykdomspuls/
  |-- sykdomspuls_pdf/
  |-- sykdomspuls_log/
/data_app/
  |-- normomo/
  |-- noispiah/
  |-- sykdomspuls/
  |-- sykdomspuls_pdf/
  |-- sykdomspuls_log/
/results/
  |-- normomo/
  |-- noispiah/
  |-- sykdomspuls/
  |-- sykdomspuls_pdf/
  |-- sykdomspuls_log/
/usr/local/lib/R/site-library/  &lt;soft linked to /r&gt;
  |-- &lt;OTHER R PACKAGES INSTALLED HERE&gt;/
  |-- fhi/
  |-- normomo/
  |-- noispiah/
  |-- sykdomspuls/
  |-- sykdomspuls_pdf/
  |-- sykdomspuls_log/
  |-- &lt;OTHER R PACKAGES INSTALLED HERE&gt;/</code></pre>
<p>Note that we have a soft link between <code>/r</code> and <code>/usr/local/lib/R/site-library/</code>.</p>
</div>
<div id="cron" class="section level3">
<h3><span class="header-section-number">2.2.3</span> cron</h3>
<p>We use <a href="https://en.wikipedia.org/wiki/Cron">cron</a> to schedule the analyses. The schedule is specified in <a href="https://github.com/raubreywhite/dashboards_control/blob/master/infrastructure/dashboards_r/crontab">crontab</a>.</p>
<p>The cronjobs are only activated when the environmental variable <code>ADD=cron</code> is defined. Cronjobs are then activated through <a href="https://github.com/raubreywhite/dashboards_control/blob/master/infrastructure/dashboards_r/add_cron.sh">add_cron.sh</a>.</p>
<p>In principle, cronjobs should only be activated on <code>smhb</code>.</p>
</div>
<div id="autofs" class="section level3">
<h3><span class="header-section-number">2.2.4</span> autofs</h3>
<p>We use <a href="https://help.ubuntu.com/community/Autofs">autofs</a> to connect to the F network. The network locations, username, and password are specified in <a href="https://github.com/raubreywhite/dashboards_control/blob/master/infrastructure/dashboards_r/auto.mounts">auto.mounts</a>.</p>
<p>Autofs is only activated when the environmental variable <code>ADD_AUTOFS=yes</code> is defined. Autofs is then activated through <a href="https://github.com/raubreywhite/dashboards_control/blob/master/infrastructure/dashboards_r/add_autofs.sh">add_autofs.sh</a>.</p>
<p>In principle, autofs should only be activated on <code>smhb</code>.</p>
</div>
</div>
<div id="reverse-proxy-docker-image" class="section level2">
<h2><span class="header-section-number">2.3</span> Reverse proxy Docker image</h2>
<p>We use nginx as a reverse proxy to make rstudio server available to the developers.</p>
<p>The relevant Dockerfile is [here](<a href="https://github.com/raubreywhite/dashboards_control/blob/master/infrastructure/dashboards_nginx/Dockerfile">raw996/dashboards_r</a> and is pushed to <a href="https://hub.docker.com/r/raw996/dashboards_nginx/">raw996/dashboards_nginx:production</a> after integration testing is passed.</p>
</div>
<div id="docker-compose" class="section level2">
<h2><span class="header-section-number">2.4</span> Docker compose</h2>
<p><a href="https://docs.docker.com/compose/">Docker compose</a> is used to integrate these Docker images into the local filesystem. We have multiple docker-compose files for different reasons:</p>
<ul>
<li>For <a href="https://github.com/raubreywhite/dashboards_control/blob/master/infrastructure/docker-compose-prod.yml">production</a> on <code>smhb</code></li>
<li>For <a href="https://github.com/raubreywhite/dashboards_control/blob/master/infrastructure/docker-compose-test.yml">testing</a> on <code>linux</code></li>
<li>For <a href="https://github.com/raubreywhite/dashboards_control/blob/master/infrastructure/docker-compose-dev.yml">development</a> on a dev computer</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="r-packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["website.pdf", "website.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
